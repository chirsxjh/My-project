## tcp

### ip报文经过一个路由器改变哪些字段

答：**无人驾驶是当前的热门话题，作者的问题是，无人驾驶是如何到达目的地的？**

输入目的地信息，汽车就在导航地图系统的带领下，左转右拐并最终到达目的地。

那导航地图系统是怎么来的？**先收集全国各地的道路信息，然后运用特定算法，算出最短路径、或最快路径。**

**路由器就是为了帮助IP报文导航而存在的，使用路由表来帮助IP报文导航**

其实IP报文和无人驾驶很相似，IP报文之所以能够到达目的地，是依靠起点到终点之间的导航系统的导航。

IP报文到达路由器之前，路由器之间已经使用OSPF/BGP协议交换好了全球的路由表，并处于同步状态，静静地等待用户IP的到来。

**路由表是如何生成的？**

一种方法，收集网络里所有的路径信息，然后运行最短路径算法，得到最短路径，这个最短路径就是路由表，可以用来为IP报文导航。

OSPF路由协议就是这么干的！

**控制报文**

很显然，OSPF、BGP的存在是为了生成导航系统（路由表），Internet上的路由器，如果把它们比如机器人，那么这些机器人都有自己独立自主的路由表。**如果每个路由器的路由表处于同步状态，可以正常转发用户IP报文；反之，可能会造成丢包或环路，就会间接造成通信障碍。**

在用户IP报文到达路由器之前，路由器之间已经使用OSPF/BGP协议交换好了全球的路由表，并处于同步状态，静静地等待用户IP的到来。

用户IP报文之后，先提取出目的IP地址，查询路由表，按照最长匹配原则（匹配的越多越好），然后从匹配到的路由条目所对应的出接口，发送给下一跳路由器。

当然在发给下一跳路由器之前，需要解决下一跳的数据链路层（二层）封装问题，这个很容易。

于是，用户的IP报文通过以上接力的方式，越来越接近终点，并最终到达终点。

[参考链接](<https://mp.weixin.qq.com/s/4vPx3EmCt1y3auBHLuu1GA>)

### 图解TCP/IP

[参考链接](<https://www.cnblogs.com/edisonchou/p/5987827.html>)